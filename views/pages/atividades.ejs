<%- include('../partials/header') %>
<!-- ./images/meditando_yoga.pnh -->
<div class="layout">

    <div class="sidebar">
        <div class="sidebar_NavContainer">
            <div class="userIcon">
                <button type="button">
                    <img src="./images/icon_user.png" alt="User">
                </button>
            </div>

            <div class="sidebar_search">
                <input 
                    type="text"
                    placeholder="Procurar"
                    name="procurar"
                    id="procurar"
                >
            </div>
        

            <div class="menu">
                <% menuItems.forEach(item => { %>
                    <a 
                    class="menu-item <%= selecionado === item ? 'active' : '' %>"
                    href="/atividades?filter=<%= item %>"
                    >
                        <%= item %>
                    </a>
                <% }) %>
            </div>


        </div> 
    </div>

    <div class="content">
       
        <div class="value">
            <h2><%= selecionado %></h2>
            <a href="/logout" class="btn-link">SAIR</a>
        </div>
        
        <div class="tasks">
            
            
            <form action="/atividades" method="post">
               <input 
                    type="text"
                    name="titulo"         
                    id="addTask"
                    placeholder="Digite uma tarefa e pressione enter"
                    required
                >
            </form>
            
            
            <% if (tarefasFiltradas.length === 0) {%> 
                <div class="emptyList">
                    <img src="/images/meditando.png" alt="Nenhuma tarefa">
                    <div class="emptyList_message">                     
                        Voc√™ n√£o possui nenhuma tarefa <% selecionado.toLowerCase() %>
                    </div>
                </div>
            <% } else {%>
                <div class="taskList">
                    <% tarefasFiltradas.forEach(tarefa => { %>
                        <div class="taskItem <%= tarefa.completada ? 'completed' : '' %>"
                            onclick="abrirModal('<%= tarefa.id_atividade %>', '<%= tarefa.titulo %>', '<%= tarefa.dataFormatada%>', `<%= tarefa.descricao || '' %>`)">

                            
                            <input 
                                type="checkbox"
                                class="checkbox-tarefa"
                                data-id="<%= tarefa.id_atividade %>"
                                <%= tarefa.completada ? 'checked' : '' %>
                            />

                            <span><%= tarefa.titulo %></span>

                            <small><% if (tarefa.dataFormatada) { %>
                                <%= tarefa.dataFormatada %>
                            <% } else {%>
                                Sem data
                            <% } %>
                            </small>  

                            <button 
                                class="favoriteBtn" 
                                data-id="<%= tarefa.id_atividade %>" 
                                data-fav="<%= tarefa.favorito %>"
                                title="Favoritar"
                                onclick="event.stopPropagation()"
                            >
                                <%= tarefa.favorito ? "‚òÖ" : "‚òÜ"%>
                            </button>

                            <form action="/atividades/excluir" method="post">
                                <input type="hidden" name="id_tarefa" value="<%= tarefa.id_atividade %>">
                                <button 
                                    type="submit" 
                                    class="deleteBtn" 
                                    title="Excluir tarefa" 
                                    onclick="event.stopPropagation()"
                                >
                                üóëÔ∏è
                                </button>
                            </form>

                        </div>
                    <% }) %>
                </div>
            <% }  %>

            <div id="modal" class="overlay" style="display: none;">
                <div class="modal">
                    <h2>Editar atividade</h2>
                    <button onclick="fecharModal()">Fechar</button>

                    <form id="editForm" method="POST" action="/atividades/editar">
                        <input type="hidden" name="id_atividade" id="edit-id">

                        <label>T√≠tulo</label>
                        <input type="text" name="titulo" id="edit-titulo">
                        
                        <label>Data</label>
                        <input type="date" name="data" id="edit-data">

                        <label>Descri√ß√£o</label>
                        <textarea name="descricao" id="edit-descricao"></textarea>

                        <button type="submit">Salvar altera√ß√µes</button>
                        <button type="button" onclick="fecharModal()">Cancelar</button>
                    </form>
                </div>
            </div>
            
        </div>

    </div>

</div>

<script src="/js/atividade.js"></script>
<%- include('../partials/footer') %>
